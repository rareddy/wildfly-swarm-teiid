

== What is Wildfly Swarm Teiid

WildFly Swarm is the decomposition and reconstitution of the popular WildFly Java Application Server, each portion of the Application Server is referred to as a fraction, **Wildfly Swarm Teiid is one of fraction** in order to run teiid as microservice type applications.

With Wildfly Swarm Teiid, you can start a Data Virtualization platform connect/compose/comsume multiple, heterogeneous data stores in simple 3 steps:

=== Step.1 add one dependency and one plugin

* WildFly Swarm Teiid Dependency

[source,xml]
----
<dependency>
  <groupId>org.wildfly.swarm</groupId>
  <artifactId>teiid</artifactId>
</dependency>
----

* WildFly Swrm Plugin

[source,xml]
----
<plugin>
  <groupId>org.wildfly.swarm</groupId>
  <artifactId>wildfly-swarm-plugin</artifactId>
  <configuration>
    <mainClass>org.wildfly.swarm.examples.teiid.Main</mainClass>
  </configuration>
  ...
</plugin>
----

=== Step.2 Develop Main class to setup connector/translator and deploy vdb

[source,java]
----
public static void main(String[] args) throws Exception {
        
    // 1. start container, configure translator
    Swarm swarm = new Swarm();
    swarm.start();
        
    // 2. deploy data sources/resource adapter
    swarm.deploy(Swarm.artifact("com.h2database:h2", "h2"));
    DatasourceArchive dsArchive = ShrinkWrap.create(DatasourceArchive.class);
    dsArchive.dataSource("accounts-ds", (ds) -> {
        ds.connectionUrl("jdbc:h2:mem:accounts;INIT=RUNSCRIPT FROM '" + teiidFiles + "/customer-schema.sql';");
        ds.driverName("h2");
        ds.userName("sa");
        ds.password("sa");
    });
    swarm.deploy(dsArchive);
        
    RARArchive rarArchive = ShrinkWrap.create(RARArchive.class);
    rarArchive.resourceAdapter("fileQS", ra -> {
        ra.module("org.jboss.teiid.resource-adapter.file");
        ra.connectionDefinitions("fileConnections", d -> {
            d.className("org.teiid.resource.adapter.file.FileManagedConnectionFactory");
            d.jndiName("java:/marketdata-file");
            d.enabled(true);
            d.configProperties("AllowParentPaths", p -> p.value("true"));
            d.configProperties("ParentDirectory", p -> p.value(teiidFiles + "/data"));
        });
    });
    swarm.deploy(rarArchive);

    // 3. deploy VDB
    VDBArchive vdb = ShrinkWrap.create(VDBArchive.class);
    vdb.vdb(Main.class.getClassLoader().getResourceAsStream("portfolio-vdb.xml"));
    swarm.deploy(vdb);     
}
----

=== Step.3 Build and Run -swarm.jar

Maven Build project generate -swarm.jar and run

[source,java]
----
java -jar target/vdb-datafederation-swarm.jar
----

